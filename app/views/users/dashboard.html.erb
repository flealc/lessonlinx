<div data-controller="side-bar">
  <div class="h1">
    Dashboard 
  </div>

  <% if current_user.students.any? %>

    <% week_lessons = current_user.lessons.this_week.where.not(status: "canceled" ).includes(:student).map(&:student).uniq { |student| student.id } %>

    <%= render partial: "shared/sidebar", 
    locals: { 
      toggle_button_action: "click->side-bar#toggle",
      array_to_iterate: week_lessons,
      link_path: ->(student_id) { recent_lessons_student_path(student_id) },
      frame: "recent_lessons_frame"
      } %>

  <% end %>

  <div class="col-9 col-sm-7" data-side-bar-target="contentArea">
    <turbo-frame id="recent_lessons_frame", src="<%= recent_lessons_student_path(week_lessons.first) if current_user.students.any? %>" >
      <div class="bg-body-tertiary">Welcome!</div>

    </turbo-frame>
  </div>

  <% recent_students = current_user.taught_lessons.includes(:student).map(&:student).uniq { |student| student.id }.first(10) %>
  <div class="col-12 col-sm-3">
    <div class="h5 ms-3" >Recent students</div>
    <div class="list-group list-group-flush pb-2 fw-normal small">

      <% recent_students.each do |student| %>

        <div class="list-group-item list-group-item-action">

          <% if student.preferred_communication_method.present? %>

            <%= link_to student.preferred_communication_method == "phone" ? "sms:#{student.preferred_contact_info}" : "mailto:#{student.preferred_contact_info}", class: "inline" do %>
              <% if student.preferred_communication_method == "phone" %>
                <i class="fa-solid fa-envelope"></i>
              <% else %>
                <i class="fa-solid fa-comment-sms"></i>
              <% end %>
            <% end%>

            <%= link_to student.full_name, student_path(student)  %>
          <% end %>
        </div>
      <% end %>
    </div>
    <% if current_user.past_lessons.scheduled.any? %>
      <%= render "users/lessons_to_log" %>
    <% end %>
  </div>

</div>

</div>
