<div data-controller="side-bar">
  <h1> Dashboard </h1>

  <i class="fa-solid fa-angle-left" data-side-bar-target="toggleIcon" data-action="click->side-bar#toggle"></i>
  <div class="row">
    <div class="col-3 col-sm-2 collapse-horizontal" data-side-bar-target="collapsibleList">
      <div class="list-group list-group-flush pb-2 fw-normal small">
        <% week_lessons = current_user.lessons.this_week.where.not(status: "canceled" ).includes(:student).map(&:student).uniq { |student| student.id } %>

        <% week_lessons.each do |student| %>
          <%= link_to "#{ student.full_name }", recent_lessons_student_path(student), data: { turbo_frame: "recent_lessons_frame"}, class: "list-group-item list-group-item-action" %>
        <% end %>
      </div>
    </div>

    <div class="col-9 col-sm-7" data-side-bar-target="contentArea">
      <turbo-frame id="recent_lessons_frame">
        <div>DIGEST PLACEHOLDER</div>
      </turbo-frame>
    </div>


    <% recent_students = current_user.taught_lessons.includes(:student).map(&:student).uniq { |student| student.id }.first(10) %>
    <div class="col-12 col-sm-3">
      <div class="h5 ms-3" >Recent students</div>
      <div class="list-group list-group-flush pb-2 fw-normal small">

        <% recent_students.each do |student| %>

          <div class="list-group-item list-group-item-action">

            <% if student.preferred_communication_method.present? %>

              <%= link_to student.preferred_communication_method == "phone" ? "sms:#{student.preferred_contact_info}" : "mailto:#{student.preferred_contact_info}", class: "inline" do %>
                <% if student.preferred_communication_method == "phone" %>
                  <i class="fa-solid fa-envelope"></i>
                <% else %>
                  <i class="fa-solid fa-comment-sms"></i>
                <% end %>
              <% end%>

            <%= link_to student.full_name, student_path(student)  %>
            <% end %>
          </div>
        <% end %>
      </div>
      <% if current_user.past_lessons.scheduled.any? %>
        <%= render "users/lessons_to_log" %>
      <% end %>
    </div>

  </div>

</div>
